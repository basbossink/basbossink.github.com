<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>PS for .NET devs part 5: Extending Visual Studio using StudioShell - Nothing to see here</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In a previous post I showed how to extract all targets defined in a given MSBuild file. Wouldn&rsquo;t it be great if the execution of those targets could be performed directly from within Visual Studio. Building on PowerShell and StudioShell this becomes trivial.
PowerShell Hosts in Visual Studio Looking in the Visual Studio Extension Manager you find a number of extensions that offer PowerShell related functionality for Visual Studio, below I&rsquo;ll briefly describe them:"><meta property="og:image" content><meta property="og:title" content="PS for .NET devs part 5: Extending Visual Studio using StudioShell"><meta property="og:description" content="In a previous post I showed how to extract all targets defined in a given MSBuild file. Wouldn&rsquo;t it be great if the execution of those targets could be performed directly from within Visual Studio. Building on PowerShell and StudioShell this becomes trivial.
PowerShell Hosts in Visual Studio Looking in the Visual Studio Extension Manager you find a number of extensions that offer PowerShell related functionality for Visual Studio, below I&rsquo;ll briefly describe them:"><meta property="og:type" content="article"><meta property="og:url" content="http://basbossink.github.io/posts/2011-12-19-ps4.netdevs-5-extending-vs/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2011-12-19T00:00:00+00:00"><meta property="article:modified_time" content="2011-12-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="PS for .NET devs part 5: Extending Visual Studio using StudioShell"><meta name=twitter:description content="In a previous post I showed how to extract all targets defined in a given MSBuild file. Wouldn&rsquo;t it be great if the execution of those targets could be performed directly from within Visual Studio. Building on PowerShell and StudioShell this becomes trivial.
PowerShell Hosts in Visual Studio Looking in the Visual Studio Extension Manager you find a number of extensions that offer PowerShell related functionality for Visual Studio, below I&rsquo;ll briefly describe them:"><script src=http://basbossink.github.io/js/feather.min.js></script>
<link href=http://basbossink.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://basbossink.github.io/css/main.40ca3a860425083862b7ebd55447caec5c4384573f0cb098b8d06a91e8dace2e.css><link id=darkModeStyle rel=stylesheet type=text/css href=http://basbossink.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css><link rel=stylesheet type=text/css href=http://basbossink.github.io/css/overrides.c755da9dccb0cb7240fb81a9a5f7b0962c285b8f6c9bcce5b2e7fa691de6a58b.css></head><body><div class=content><header><div class=main><a href=http://basbossink.github.io/>Nothing to see here</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/projects>Projects</a>
<a href=/about>About</a></nav></header><main><article><div class=title><h1 class=title>PS for .NET devs part 5: Extending Visual Studio using StudioShell</h1><div class=meta>Posted on Dec 19, 2011</div></div><section class=body><p>In a <a href=/2011-11-19/ps4.netdevs-3-list-targets/ title="PS for .NET devs part 3: List Targets in your MSBuild file">previous post</a> I showed how to extract all targets
defined in a given MSBuild file. Wouldn&rsquo;t it be great if the
execution of those targets could be performed directly from within
Visual Studio. Building on <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a> and <a href=http://studioshell.codeplex.com/ title="StudioShell home page">StudioShell</a>
this becomes trivial.</p><h3 id=powershell-hosts-in-visual-studio>PowerShell Hosts in Visual Studio</h3><p>Looking in the <a href=http://msdn.microsoft.com/en-us/library/dd293638.aspx title="Visual Studio Extension Manager">Visual Studio Extension Manager</a> you find a number
of extensions that offer <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a> related functionality for Visual
Studio, below I&rsquo;ll briefly describe them:</p><ol><li><a href=http://nuget.org title="NuGet home page">NuGet Package Manager Console</a><br><a href=http://nuget.org title="NuGet home page">NuGet</a> is a .NET package manager, comparable to for
instance <a href=http://www.ruby-lang.org/en/ title=Ruby>Ruby</a> <a href=http://rubygems.org/ title="Ruby Gems">Gems</a>, that you can use to easily install
and use .NET libraries in your project. <a href=http://nuget.org title="NuGet home page">NuGet</a> can be used
to install libraries into your project by downloading the library
adding a reference to your project and possibly editing
configuration files if that should be necessary. Packages can be
managed through a set of <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a> Cmdlets, such as:<ul><li><code>Get-Package</code></li><li><code>Install-Package</code></li><li><code>Uninstall-Package</code></li><li><code>Update-Package</code></li><li><code>New-Package</code></li><li><code>Get-Project</code></li><li><code>Add-BindingRedirect</code></li><li><code>Open-PackagePage</code></li><li><code>Register-TabExpansion</code><br>Besides the <a href=http://nuget.org title="NuGet home page">NuGet</a> Cmdlets the package manager console
does not provide any extra functionality over the standard
<a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a> console.</li></ul></li><li><a href=http://powerguivsx.codeplex.com/ title="PowerGUI Visual Studio Extension">PowerGUI Visual Studio Extension</a><br>This great extension has two parts:<ul><li>a <a href=http://www.powergui.org/ title=PowerGUI>PowerGUI</a> Console<br>this is again a <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ee706610(v=vs.85).aspx" title="PowerShell Host overview">PowerShell host</a> inside Visual Studio
comparable to the host you find in <a href=http://www.powergui.org/ title=PowerGUI>PowerGUI</a></li><li>an editor extension equivalent to the
<a href=http://wiki.powergui.org/index.php/Script_Editor title="PowerGUI Script Editor">PowerGUI Script Editor</a><br>with a rich feature set such as, IntelliSense, snippets, syntax
highlighting and even debugging
In my opinion this is a must have Visual Studio extension and best
of all it&rsquo;s free of charge.</li></ul></li><li><a href=http://visualstudiogallery.msdn.microsoft.com/67620d8c-93dd-4e57-aa86-c9404acbd7b3 title=PowerConsole>PowerConsole</a><br>Is a <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ee706610(v=vs.85).aspx" title="PowerShell Host overview">PowerShell host</a> that has some extra functionality compared
to the <a href=http://nuget.org title="NuGet home page">NuGet</a> package manager console. It exposes Visual
Studio&rsquo;s COM API by providing a <code>$dte</code> variable. That is an
instance of <a href=http://msdn.microsoft.com/en-us/library/envdte.dte.aspx title=DTE>DTE</a> which is the entry point to the Visual Studio
Automation API. Apart from that, a few Cmdlets
(<code>Get-VSService</code>,<code>Get-Interface</code>, <code>Get-VSComponentModel</code>) are provided to
interact with the managed API. Judging from the examples provided
on the website these provide a very C# like interaction with
Visual Studio.</li><li><a href=http://visualstudiogallery.msdn.microsoft.com/9b3272d4-6d13-4c1c-93bc-3ec74614508e title=PowerStudio>PowerStudio</a><br>Offers a rich editing experience for <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a>, feature wise
almost comparable to the
<a href=http://powerguivsx.codeplex.com/ title="PowerGUI Visual Studio Extension">PowerGUI Visual Studio Extension</a>.
I have not used this extension in anger but it feels OK. The thing
it&rsquo;s missing compared to the
<a href=http://powerguivsx.codeplex.com/ title="PowerGUI Visual Studio Extension">PowerGUI Visual Studio Extension</a> is the IntelliSense
for file names.</li><li><a href=http://studioshell.codeplex.com/ title="StudioShell home page">StudioShell</a><br>In this case I&rsquo;m saving the best for last. <a href=http://studioshell.codeplex.com/ title="StudioShell home page">StudioShell</a>
is again a <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a> host for Visual Studio where in my
opinion the Visual Studio API is surfaced in the most
<a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a>-like way. The before mentioned <a href=http://msdn.microsoft.com/en-us/library/envdte.dte.aspx title=DTE>DTE</a> object is
surfaced as a <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a> <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ee126186(v=VS.85).aspx" title="PowerShell provider">provider</a>. This makes
interacting with VS really easy as you will see in the example
below. Furthermore <a href=http://studioshell.codeplex.com/ title="StudioShell home page">StudioShell</a> offers several
<a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb613488(v=vs.85).aspx" title="PowerShell profiles">profile</a> options, one of which is a <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb613488(v=vs.85).aspx" title="PowerShell profiles">profile</a> per
solution. This makes it very easy to develop your VS extras on a
solution specific basis. Let&rsquo;s expand on the
<a href=/2011-11-19/ps4.netdevs-3-list-targets/ title="PS for .NET devs part 3: List Targets in your MSBuild file">previous article about listing all targets in a MSBuild file</a>
by creating a Visual Studio extension that adds a menu were each of the
available targets can be executed from within Visual Studio. Building on
<a href=http://studioshell.codeplex.com/ title="StudioShell home page">StudioShell</a> this becomes a piece of cake.</li></ol><h3 id=extending-visual-studio-with-studioshell>Extending Visual Studio with StudioShell</h3><p>Here&rsquo;s a little snippet that adds a command bar to Visual Studio with a button
for each available MSBuild target.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>New-Item</span> dte:/commandBars -Name <span style=color:#f1fa8c>&#34;MSBuild&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$solutiondir</span> = <span style=color:#8be9fd;font-style:italic>Split-Path</span> (<span style=color:#8be9fd;font-style:italic>get-item</span> dte:\solution).FileName
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>cd </span><span style=color:#8be9fd;font-style:italic>$solutiondir</span>
</span></span><span style=display:flex><span>.\<span style=color:#8be9fd;font-style:italic>Get-MsBuildTargets</span>.ps1 | <span style=color:#8be9fd;font-style:italic>ForEach-Object</span> { 
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>$command</span> = <span style=color:#f1fa8c>&#34;New-Item </span><span style=color:#f1fa8c>`&#34;</span><span style=color:#f1fa8c>dte:\commandBars\MSBuild</span><span style=color:#f1fa8c>`&#34;</span><span style=color:#f1fa8c> -Name </span>$(<span style=color:#8be9fd;font-style:italic>$_</span>.Name)<span style=color:#f1fa8c> -Type button -Value { 
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        pushd .
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        cd $solutiondir
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        .\MSBuildTarget.bat </span>$(<span style=color:#8be9fd;font-style:italic>$_</span>.Name)<span style=color:#f1fa8c> | 
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            Out-Outputpane -name MSBuild
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        popd 
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    }&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>Invoke-Expression</span> <span style=color:#8be9fd;font-style:italic>$command</span> 
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>In the documentation I could not find how to use the
<code>EventArgs</code> that you would guess would be passed to this event handler.
Therefor I resorted to the use of string interpolation and <code>Invoke-Expression</code>.
This is only a small example, you can find some more examples on the
<a href=http://studioshell.codeplex.com/ title="StudioShell home page">StudioShell</a> <a href="http://studioshell.codeplex.com/wikipage?title=Examples&referringTitle=Documentation" title="StudioShell Examples page">examples page</a>. This snippet could be put
in your solution profile. The <code>MSBuildTarget.bat</code> command basically does what
the name says, it calls <code>msbuild</code> with the given target using the build file
for the project. Yes, I know all batch files should by replaced with their
<a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">next generation alternative</a> but this project started before <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a>
version 1.0 shipped. Somehow we never seem to get the time to rewrite them 😃.</p><p>I hope this presents a nice starter for enhancing your Visual Studio
productivity with <a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title="Scripting with Windows PowerShell">PowerShell</a>.</p><h5 id=references>References</h5><ul><li><a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419>Scripting with Windows
PowerShell</a></li><li><a href=http://studioshell.codeplex.com/>StudioShell home page</a></li><li><a href=/2011-11-19/ps4.netdevs-3-list-targets/>PS for .NET devs part 3: List Targets in your MSBuild file</a></li><li><a href="http://studioshell.codeplex.com/wikipage?title=Examples&referringTitle=Documentation">StudioShell Examples page</a></li><li><a href=http://nuget.org>NuGet home page</a></li><li><a href=http://powerguivsx.codeplex.com/>PowerGUI Visual Studio Extension</a></li><li><a href=http://visualstudiogallery.msdn.microsoft.com/67620d8c-93dd-4e57-aa86-c9404acbd7b3>PowerConsole</a></li><li><a href=http://visualstudiogallery.msdn.microsoft.com/9b3272d4-6d13-4c1c-93bc-3ec74614508e>PowerStudio</a></li><li><a href=http://msdn.microsoft.com/en-us/library/dd293638.aspx>Visual Studio Extension Manager</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ee706610(v=vs.85).aspx">PowerShell Host overview</a></li><li><a href=http://www.ruby-lang.org/en/>Ruby</a></li><li><a href=http://rubygems.org/>Ruby Gems</a></li><li><a href=http://www.powergui.org/>PowerGUI</a></li><li><a href=http://wiki.powergui.org/index.php/Script_Editor>PowerGUI Script Editor</a></li><li><a href=http://msdn.microsoft.com/en-us/library/envdte.dte.aspx>DTE</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/bb613488(v=vs.85).aspx">PowerShell profiles</a></li><li><a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ee126186(v=VS.85).aspx">PowerShell provider</a></li></ul></section><div class=post-tags></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/basbossink/ title=GitHub><i data-feather=github></i></a><a class=soc href=https://twitter.com/basbossink/ title=Twitter><i data-feather=twitter></i></a></div><div class=footer-info>2022 © Bas Bossink | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>