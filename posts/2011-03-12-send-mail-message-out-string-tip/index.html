<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Quick Powershell tip concerning Out-String and Send-MailMessage - Nothing to see here</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Recently I wrote a script at work to generate a report about the load on a set of servers. The gathered statistics were mailed around everything nice and dandy. But after a few weeks something strange happened the body of the mail message containing a nice table got turned into gibberish.
Cause I really didn&rsquo;t understand want went wrong all of a sudden, so I started to inspect the output of the script."><meta property="og:image" content><meta property="og:title" content="Quick Powershell tip concerning Out-String and Send-MailMessage"><meta property="og:description" content="Recently I wrote a script at work to generate a report about the load on a set of servers. The gathered statistics were mailed around everything nice and dandy. But after a few weeks something strange happened the body of the mail message containing a nice table got turned into gibberish.
Cause I really didn&rsquo;t understand want went wrong all of a sudden, so I started to inspect the output of the script."><meta property="og:type" content="article"><meta property="og:url" content="http://basbossink.github.io/posts/2011-03-12-send-mail-message-out-string-tip/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-06-18T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-18T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Quick Powershell tip concerning Out-String and Send-MailMessage"><meta name=twitter:description content="Recently I wrote a script at work to generate a report about the load on a set of servers. The gathered statistics were mailed around everything nice and dandy. But after a few weeks something strange happened the body of the mail message containing a nice table got turned into gibberish.
Cause I really didn&rsquo;t understand want went wrong all of a sudden, so I started to inspect the output of the script."><script src=http://basbossink.github.io/js/feather.min.js></script>
<link href=http://basbossink.github.io/css/fonts.b685ac6f654695232de7b82a9143a46f9e049c8e3af3a21d9737b01f4be211d1.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=http://basbossink.github.io/css/main.40ca3a860425083862b7ebd55447caec5c4384573f0cb098b8d06a91e8dace2e.css><link id=darkModeStyle rel=stylesheet type=text/css href=http://basbossink.github.io/css/dark.726cd11ca6eb7c4f7d48eb420354f814e5c1b94281aaf8fd0511c1319f7f78a4.css><link rel=stylesheet type=text/css href=http://basbossink.github.io/css/overrides.c755da9dccb0cb7240fb81a9a5f7b0962c285b8f6c9bcce5b2e7fa691de6a58b.css></head><body><div class=content><header><div class=main><a href=http://basbossink.github.io/>Nothing to see here</a></div><nav><a href=/>Home</a>
<a href=/posts>All posts</a>
<a href=/projects>Projects</a>
<a href=/about>About</a></nav></header><main><article><div class=title><h1 class=title>Quick Powershell tip concerning Out-String and Send-MailMessage</h1><div class=meta>Posted on Jun 18, 2022</div></div><section class=body><p>Recently I wrote a script at work to generate a report about the load
on a set of servers. The gathered statistics were mailed around
everything nice and dandy. But after a few weeks something strange
happened the body of the mail message containing a nice table got
turned into gibberish.</p><h2 id=cause>Cause</h2><p>I really didn&rsquo;t understand want went wrong all of a sudden, so
I started to inspect the output of the script. And low and behold the
trouble was caused by the fact that <a href=http://technet.microsoft.com/en-us/library/dd315365.aspx title=Out-String>Out-String</a> by default puts
only 80 characters in a line. Quoting the documentation:</p><blockquote><p>-Width &lt;int>
Specifies the number of characters in each line of output. Any
additional characters are truncated, not wrapped. If you omit this
parameter, the width is determined by the characteristics of the host.
The default for the PowerShell.exe host is 80 (characters).</p></blockquote><p>If you&rsquo;re lucky the line breaks end up outside of your tags which was
the case for me the first couple of times the script ran. But if
<a href=http://technet.microsoft.com/en-us/library/dd315365.aspx title=Out-String>Out-String</a> happens to break the line inside an HTML tag, your
output gets garbled.</p><h2 id=solution>Solution</h2><p>I thought this would be easy to fix just specify <code>[int]::MaxValue</code> for
the <code>-Width</code> parameter to Out‑String. Trying that in a
<a href=http://technet.microsoft.com/en-us/scriptcenter/dd742419 title=PowerShell>PowerShell</a> console gave:
<img src=wrong-width.png alt="Out-String with unsatisfactory result" title="Wrong syntax for the width parameter">
Hum, seems like the <code>[int]::MaxValue</code> doesn&rsquo;t get evaluated before it
is interpreted by Out‑String so some extra parenthesis should do the
trick.</p><h2 id=end-result>End result</h2><p>The paragraph of code that I use to send around an HTML table
containing the load statistics hence becomes something like this:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ps1 data-lang=ps1><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>$messageParameters</span> = @{
</span></span><span style=display:flex><span>    Subject = <span style=color:#f1fa8c>&#34;Weekly load report&#34;</span>
</span></span><span style=display:flex><span>    Body = (<span style=color:#8be9fd;font-style:italic>Get-LoadStatistics</span> | <span style=color:#8be9fd;font-style:italic>ConvertTo-Html</span> -Head <span style=color:#8be9fd;font-style:italic>$head</span> | 
</span></span><span style=display:flex><span>        <span style=color:#8be9fd;font-style:italic>Out-String</span> -Width ([int]::MaxValue))
</span></span><span style=display:flex><span>    From = <span style=color:#f1fa8c>&#34;donotreply@devnull.org&#34;</span>
</span></span><span style=display:flex><span>    To = <span style=color:#f1fa8c>&#34;fred.flinstone@bedrock.com&#34;</span>
</span></span><span style=display:flex><span>    SmtpServer = <span style=color:#f1fa8c>&#34;my.smtpserver&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>Send-MailMessage</span> <span style=color:#8be9fd;font-style:italic>@messageParameters</span> -BodyAsHtml
</span></span></code></pre></td></tr></table></div></div><p>I hope this helps anybody using the Power to send nice reports.</p></section><div class=post-tags></div></article></main><footer><div style=display:flex><a class=soc href=https://github.com/basbossink/ title=GitHub><i data-feather=github></i></a><a class=soc href=https://twitter.com/basbossink/ title=Twitter><i data-feather=twitter></i></a></div><div class=footer-info>2022 © Bas Bossink | <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></div></footer><script>feather.replace()</script></div></body></html>